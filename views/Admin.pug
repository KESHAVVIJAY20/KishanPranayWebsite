doctype html
head
  meta(charset='UTF-8')
  meta(name='viewport' content='width=device-width, initial-scale=1.0')
  title Kishan Pranay - Futurist and Innovation Adviser
  link(rel='stylesheet' href='admin.css')
  link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH' crossorigin='anonymous')
  script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz' crossorigin='anonymous')
  link(rel='stylesheet', href='https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css')
  script(src='https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js')
  script(src="https://code.jquery.com/jquery-3.6.0.min.js")

  script.
    document.addEventListener('DOMContentLoaded', function() {
      AOS.init(
        {
          offset:200,
        }
      );
    }); 

  .sidebar(data-aos='fade-up')
    h3(data-aos='zoom-in').mb-5 Kishan Pranay&apos;s Dashboard
    a.p-3(href='#' data-section='dashboard') 
      img.w-25.h-25.pe-1(src="./svg/home.svg") 
      |  Dashboard
    a.p-3(href='#' data-section='users') 
      img.w-25.h-25.pe-1(src="./svg/users.svg")
      |  Users
    a.p-3(href='#' data-section='products') 
      img.w-25.h-25.pe-1(src="./svg/book.svg")
      |  Books
    a.p-3(href='#' data-section='orders') 
      img.w-25.h-25.pe-1(src="./svg/orders.svg")  
      |  Orders
    a.p-3(href='#' data-section='reports')
      img.w-25.h-25.pe-1(src="./svg/reports.svg")  
      |  Reports
    a.p-3(href='#' data-section='settings')
      img.w-25.h-25.pe-1(src="./svg/settings.svg")  
      |  Settings
  .content
    //- nav.navbar.navbar-expand-lg.navbar-light.bg-light
      //- .container-fluid
      //-   a.navbar-brand(href='#') Dashboard
    .container.mt-4
      #dashboard.section.active
        h2.fs-1.font-monospace Dashboard
        p Welcome to the admin dashboard.
        .container.mt-4
          .row
            .col-md-3(data-aos='zoom-in')
              .card.text-white.bg-primary.mb-3
                .card-body
                  h5.card-title Total Users
                  p.card-text.fs-1 #{users.length}
                  //- p.card-text Manage Users here.
            .col-md-3(data-aos='zoom-in')
              .card.text-white.bg-success.mb-3
                .card-body
                  h5.card-title Total Books
                  p.card-text.fs-1 #{users.length}
            .col-md-3(data-aos='zoom-in')
              .card.text-white.bg-warning.mb-3
                .card-body
                  h5.card-title Orders
                  p.card-text View and manage Orders here.
            .col-md-3(data-aos='zoom-in')
              .card.text-white.bg-danger.mb-3
                .card-body
                  h5.card-title Reports
                  p.card-text Generate and view Reports here.
      #users.section
        h2.text-center.fs-1 Users
        table.border.text-center.d-flex-col.mx-auto
          thead.border
            tr
              th Date Joined
              th Username
              th Usermail
          tbody 
            if Array.isArray(users) && users.length > 0
              each user in users
                tr.border-bottom
                  td.p-3= new Date(user.dateJoined).toLocaleDateString()
                  td.p-3= user.Username
                  td.p-3= user.Usermail
                  td.p-3
                    button.m-1(data-id=user._id, class="btn btn-warning edit-btn") Edit
                    button(data-id=user._id, class="btn btn-danger delete-btn") Delete
            else
              tr
                td(colspan="2") No users found

      #products.section.text-center 
        h2  BOOKS
        table.border.text-center.d-flex-col.mx-auto
          thead.border
            tr
              th Date Of Creation
              th BookName
              th BookId
          tbody 
            if Array.isArray(users) && users.length > 0
              each user in users
                tr.border-bottom
                  td.p-3= new Date(user.dateJoined).toLocaleDateString()
                  td.p-3= user.Username
                  td.p-3= user.Usermail
                  td.p-3
                    button.m-1(data-id=user._id, class="btn btn-warning edit-btn") Edit
                    button(data-id=user._id, class="btn btn-danger delete-btn") Delete
            else
              tr
                td(colspan="2") No users found
      #orders.section
        h2 Orders
        p View and manage orders here.
      #reports.section
        h2 Reports
        p Generate and view reports here.
      #settings.section
        h2 Settings
        p Configure settings here.


    #editModal.modal.fade
      .modal-dialog
        .modal-content
          .modal-header
            h5.modal-title Edit User
            button(type="button", class="btn-close", data-bs-dismiss="modal", aria-label="Close")
          .modal-body
            form#editForm(method="POST")
              .mb-3
                label(for="editUsername", class="form-label") Username
                input#editUsername(type="text", class="form-control", name="Username")
              .mb-3
                label(for="editUsermail", class="form-label") Usermail
                input#editUsermail(type="email", class="form-control", name="Usermail")
              button(type="submit", class="btn btn-primary") Save changes

          .modal-footer
            button(type="button", class="btn btn-secondary", data-bs-dismiss="modal") Close
    
    #deleteModal.modal.fade.mt-5.pt-5
        .modal-dialog
          .modal-content
            .modal-header
              h5.modal-title Delete User
              button(type="button", class="btn-close", data-bs-dismiss="modal", aria-label="Close")
            .modal-body
              p.text-center Are you sure you want to delete this user?
              form#deleteForm.text-center(method="POST")
                input#deleteUserId(type="hidden", name="id")
                button.me-2(type="submit", class="btn btn-danger") Yes Delete
                button(type="button", class="btn btn-secondary" data-bs-dismiss="modal") Cancel

            //- .modal-footer
            //-   button(type="button", class="btn btn-secondary", data-bs-dismiss="modal") Close
    

script(src='https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js')
script.
  document.querySelectorAll('.sidebar a').forEach(link => {
  link.addEventListener('click', function(event) {
  event.preventDefault();
  document.querySelectorAll('.section').forEach(section => {
  section.classList.remove('active');
  });
  const sectionId = this.getAttribute('data-section');
  document.getElementById(sectionId).classList.add('active');
  });
  });

script.
  $(document).ready(function() {
    $('.delete-btn').click(function() {
      const userId = $(this).data('id');
      $('#deleteUserId').val(userId);
      $('#deleteModal').modal('show');
    });

    // Delete user
    $('#deleteForm').submit(function(e) {
      e.preventDefault();
      const userId = $('#deleteUserId').val();
      $.ajax({
        url: `/admin/${userId}`,
        type: 'DELETE',
        success: function(result) {
          alert(result.message);
          $('#deleteModal').modal('hide');
          location.reload(); // Reload the page to update the list
        },
        error: function(xhr, status, error) {
          alert('Error deleting user');
        }
      });
    });

    // Edit user
    $('.edit-btn').click(function(e) {
      e.preventDefault();
      const userId = $(this).data('id');
      $.get(`/admin/${userId}`, function(user) {
        $('#editUsername').val(user.Username);
        $('#editUsermail').val(user.Usermail);
        $('#editForm').attr('action', `/admin/${userId}`);
        $('#editModal').modal('show');
      });
    });

    // Handle form submission for editing
    $('#editForm').submit(function(e) {
      e.preventDefault();
      const form = $(this);
      $.ajax({
        url: form.attr('action'),
        type: 'PUT',
        data: form.serialize(),
        success: function(result) {
          //- alert(result.message);
          $('#editModal').modal('hide');
          location.reload(); // Reload the page to update the list
        },
        error: function(xhr, status, error) {
          alert('Error updating user');
        }
      });
    });
  });
